ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №3
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Розробка бізнес-логіки та функцій адміністрування»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Реалізація адмін-панелі та модуля статистики    |

2 ЗАВДАННЯ

1. Розширити функціонал серверної частини модулем адміністрування.
2. Реалізувати бізнес-логіку обробки статистичних даних (агрегація, математичні розрахунки).
3. Забезпечити можливість експорту даних у машиночитаний формат (CSV).

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Інженерні рішення

В рамках лабораторної роботи було розроблено два нових сервіси: `AdminService` та `StatsService`.

**Експорт даних (CSV):**
Для реалізації експорту даних у формат CSV використано клас `std::stringstream`. Це дозволяє формувати великі текстові дані в пам'яті ефективно, без зайвих операцій вводу-виводу на диск перед відправкою.
- Метод: `GET /api/admin/export/csv`
- HTTP-заголовки: `Content-Type: text/csv`, `Content-Disposition: attachment` (для ініціації скачування браузером).

**Адміністрування:**
Реалізовано методи для управління контентом (додавання типів сміття) та користувачами (блокування доступу). Блокування реалізовано через прапорець `is_active` в БД.

3.2 Математичні методи

У модулі статистики (`StatsService`) реалізовано алгоритми агрегації даних:
- **Розрахунок загальної ваги:** Використання SQL-агрегації `SUM(weight)` для швидкого підрахунку.
- **Визначення ТОП-активних користувачів:** Сортування агрегованих даних за спаданням (`ORDER BY SUM(weight) DESC`) та лімітування вибірки.
- **Обчислення середнього навантаження:** Математична формула для оцінки ефективності роботи пунктів (емуляція).

3.3 Фрагменти коду

**Експорт у CSV (`AdminService`):**
```cpp
std::string exportTransactionsToCsv() {
    auto transactions = transRepo.getAll();
    std::stringstream ss;
    ss << "ID,UserID,WasteID,Weight,Bonus\n";
    for (const auto& t : transactions) {
        ss << t.id << "," << t.user_id << "," << t.waste_id << "," 
           << t.weight << "," << t.bonus << "\n";
    }
    return ss.str();
}
```

**Отримання ТОП користувачів (`Database`):**
```cpp
std::string sql = "SELECT user_id, SUM(weight) as total_w FROM transactions "
                  "GROUP BY user_id ORDER BY total_w DESC LIMIT " + std::to_string(limit);
```

4 ВИСНОВКИ

В ході виконання лабораторної роботи система EcoRecycle була доповнена критично важливими бізнес-функціями. Реалізація експорту даних та статистичного аналізу дозволяє перетворити систему з простого трекера на інструмент управління процесами переробки. Використання C++ дозволило реалізувати складні вибірки та формування звітів з високою швидкодією.

ДОДАТОК Б
Графічні матеріали

(Опис діаграм, які мають бути додані до звіту)

1. **UML Activity Diagram (Експорт даних):** 
   - Початок: Адміністратор натискає "Експорт".
   - Система перевіряє права.
   - Система витягує транзакції з БД.
   - Система формує CSV потік.
   - Кінець: Браузер завантажує файл.

2. **UML Sequence Diagram (Блокування користувача):**
   - AdminController -> AdminService: blockUser(id)
   - AdminService -> UserRepository: block(id)
   - UserRepository -> Database: UPDATE query
   - Database -> UserRepository: Success
   - AdminController -> Admin: 200 OK
