ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №3
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Розробка бізнес-логіки та функцій адміністрування»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Реалізація функцій блокування та експорту даних |

2 ЗАВДАННЯ

1. Розробити модуль адміністрування (додавання сміття, блокування користувачів).
2. Реалізувати експорт даних про транзакції у формат CSV.
3. Реалізувати модуль статистики з математичними розрахунками.

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Інженерні рішення

Для автоматизації збірки та запуску проєкту розроблено скрипт `start.sh`, який виконує компіляцію через CMake та запуск сервера однією командою.

3.2 Адміністрування користувачів та маршрутів

Було реалізовано можливість адміністратору керувати даними у системі. Адміністратор може додавати нові типи відходів, встановлюючи їм ціну, а також блокувати користувачів, обмежуючи їх доступ до системи. Всі дії виконуються через API, що взаємодіє з сервісами та репозиторіями, забезпечуючи цілісність даних.
Детальна взаємодія показана на діаграмах (Додаток Б).

3.3 Експорт даних (CSV)

Для забезпечення можливості аналізу даних сторонніми засобами було розроблено функціонал експорту транзакцій у формат CSV. Метод формує текстовий потік "на льоту", що дозволяє уникнути збереження файлів на сервері та зменшує навантаження на дискову підсистему.
Фрагмент реалізації наведено у Додатку В.1.

3.4 Модуль статистики

Реалізовано розрахунок глобальної статистики системи:
- Загальна вага зібраної сировини `SUM(weight)`.
- Загальна сума нарахованих бонусів `SUM(bonus)`.
- Кількість транзакцій.
- Топ користувачів за активністю (Додаток В.2).

4 ВИСНОВОК

У ході виконання роботи було розроблено ключові функції адміністрування та аналітики серверної частини системи EcoRecycle. Було реалізовано управління типами відходів та користувачами, а також функціонал експорту даних у CSV.
Для аналітики реалізовано збір глобальної статистики, що дозволяє оцінювати ефективність роботи платформи.
Усі функції були реалізовані з урахуванням взаємодії між шарами системи (Repository-Service-Controller), що забезпечує чистоту архітектури та легкість підтримки.

5 ВИКОРИСТАНІ ДЖЕРЕЛА

1. Crow C++ Framework Documentation. URL: https://crowcpp.org/
2. SQLite Documentation. URL: https://www.sqlite.org/docs.html
3. RFC 4180 - Common Format and MIME Type for Comma-Separated Values (CSV) Files.

ДОДАТОК А
Посилання на відео: https://youtu.be/dp9Rgo0Ji_o 
00:00 Вступ
00:35 Функції адміністрування (блокування, додавання відходів)
01:12 Експорт даних у CSV
02:44 Перегляд статистики
03:13 Тестування API

ДОДАТОК Б
Графічні матеріали

Рисунок Б.1 – Діаграма класів контролерів та сервісів

ДОДАТОК В
Фрагменти коду

В.1 Експорт у CSV
```cpp
crow::response Controllers::exportCsv(const crow::request& req) {
    auto transactions = Database::getInstance().getAllTransactions();
    
    std::stringstream ss;
    ss << "ID,UserID,WasteID,Weight,Bonus,Timestamp\n";
    
    for (const auto& t : transactions) {
        ss << t.id << "," 
           << t.user_id << "," 
           << t.waste_id << "," 
           << std::fixed << std::setprecision(2) << t.weight << "," 
           << t.bonus << "," 
           << t.timestamp << "\n";
    }
    
    crow::response res(ss.str());
    res.set_header("Content-Type", "text/csv");
    res.set_header("Content-Disposition", "attachment; filename=export.csv");
    return res;
}
```

В.2 Отримання статистики (StatsService)
```cpp
GlobalStatsDto getGlobalStats() {
    GlobalStatsDto stats;
    stats.total_weight = Database::getInstance().getTotalWeight();
    stats.total_bonuses = Database::getInstance().getTotalBonuses();
    stats.transactions_count = Database::getInstance().getTransactionCount();
    
    if (stats.transactions_count > 0) {
        stats.average_weight_per_transaction = stats.total_weight / stats.transactions_count;
    } else {
        stats.average_weight_per_transaction = 0.0;
    }

    stats.top_users = Database::getInstance().getTopUsers(3);
    
    return stats;
}
```
