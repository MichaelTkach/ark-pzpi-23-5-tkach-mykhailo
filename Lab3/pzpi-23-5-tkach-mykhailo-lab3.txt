ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №3
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Розробка бізнес-логіки та функцій адміністрування»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Реалізація функцій блокування та експорту даних |

2 ЗАВДАННЯ

1. Розробити модуль адміністрування (додавання сміття, блокування користувачів).
2. Реалізувати експорт даних про транзакції у формат CSV.
3. Реалізувати модуль статистики з математичними розрахунками.

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Інженерні рішення

Для реалізації завдань було розширено структуру бази даних, додано поле `is_active` для користувачів.
Реалізовано клас `Controllers` з новими методами:
- `blockUser` — виконує UPDATE запит до БД для зміни статусу користувача.
- `addWasteType` — додає новий запис у таблицю категорій.
- `exportCsv` — формує текстовий потік даних (MIME type: `text/csv`).

**Експорт CSV:**
Використано `std::stringstream` для конкатенації рядків. Це дозволяє сформувати файл "на льоту" та віддати його користувачеві без збереження на диск сервера, що економить ресурси.

3.2 Математичні методи

У контролері `getStats` реалізовано розрахунок ключових показників:
1. **Загальна вага:** `SUM(weight)` (SQL агрегація).
2. **Середня вага здачі:** `TotalWeight / Count`.

3.3 Фрагменти коду

**Генерація CSV:**
```cpp
auto transactions = Database::getInstance().getAllTransactions();
std::stringstream ss;
ss << "ID,UserID,WasteID,Weight,Bonus,Timestamp\n";

for (const auto& t : transactions) {
    ss << t.id << "," << t.user_id << "," << t.waste_id << "," 
       << t.weight << "," << t.bonus << "\n";
}
crow::response res(ss.str());
res.set_header("Content-Disposition", "attachment; filename=export.csv");
return res;
```

**Математичний розрахунок:**
```cpp
double avgWeight = (count > 0) ? (totalWeight / count) : 0.0;
```

4 ВИСНОВКИ

В результаті виконання роботи система отримала інструменти для адміністративного керування даними та аналізу ефективності. Реалізація експорту в CSV забезпечує інтероперабельність системи з іншими інструментами аналізу (Excel, Google Sheets). Використання C++ дозволило реалізувати це з високою швидкодією.

ДОДАТОК А
Демонстраційний відеоматеріал
Посилання: https://youtu.be/XYZ_LAB3_FAKE
