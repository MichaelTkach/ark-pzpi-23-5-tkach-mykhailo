ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №2
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Проектування та розробка серверної частини»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Розробка базової архітектури БД та API          |
| 2.0    | 05.02.2025 | Ткач М.    | Впровадження Layered Architecture, патернів Repository та Strategy |

2 ЗАВДАННЯ

1. Спроектувати масштабовану архітектуру серверної частини.
2. Розробити REST API з використанням мови C++ та патернів проєктування.
3. Реалізувати бізнес-логіку з використанням DTO та розподілом відповідальності.

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Інженерні рішення

При розробці серверної частини було застосовано **Шарувату архітектуру (Layered Architecture)**, що забезпечує чіткий розподіл відповідальності (Separation of Concerns).

Використані рішення та патерни:
- **Repository Pattern:** Абстрагує шар доступу до даних (DAL). Класи `UserRepository`, `WasteRepository` інкапсулюють логіку побудови SQL-запитів, дозволяючи бізнес-логіці працювати з об'єктами, а не з таблицями БД.
- **Strategy Pattern:** Використано для алгоритму нарахування бонусів. Інтерфейс `IBonusStrategy` дозволяє гарячу заміну логіки (наприклад, `EcoHeroBonusStrategy` з підвищеним коефіцієнтом) без зміни основного коду сервісу.
- **Service Layer:** Класи `AuthService` та `RecyclingService` містять чисту бізнес-логіку, ізольовану від HTTP-контролерів.
- **DTO (Data Transfer Objects):** Використання структур `RegisterDto` та `RecycleDto` для типізованої передачі даних між шарами контролерів та сервісів.
- **Security Middleware:** Впроваджено механізм перехоплення запитів для перевірки авторизації.

Технологічний стек: C++17, Crow (Microframework), SQLite3, CMake.

3.2 Специфікація API

| Метод | URL                | Опис                                      | Middleware |
|-------|--------------------|-------------------------------------------|------------|
| POST  | /api/auth/register | Реєстрація (DTO: RegisterDto)             | -          |
| POST  | /api/recycle       | Фіксація здачі (DTO: RecycleDto)          | Auth Check |
| GET   | /api/points        | Отримати список пунктів                   | -          |
| GET   | /api/user/history  | Історія транзакцій користувача            | Auth Check |

3.3 Реалізація

**Приклад інтерфейсу Репозиторію (`include/repositories.h`):**
```cpp
template <typename T>
class IRepository {
public:
    virtual std::vector<T> getAll() = 0;
    virtual std::optional<T> getById(int id) = 0;
};

class UserRepository : public IRepository<User> {
public:
    bool create(const User& user) {
        return Database::getInstance().createUser(user.email, user.password_hash, user.role);
    }
};
```

**Приклад патерну Стратегія (`include/services.h`):**
```cpp
class IBonusStrategy {
public:
    virtual double calculate(double weight, double pricePerKg) = 0;
};

class EcoHeroBonusStrategy : public IBonusStrategy {
public:
    double calculate(double weight, double pricePerKg) override {
        return weight * pricePerKg * 1.5; // Підвищений бонус
    }
};
```

**Приклад Сервісу (`RecyclingService`):**
```cpp
double processRecycling(const RecycleDto& dto) {
    double price = wasteRepo.getPricePerKg(dto.waste_id);
    auto strategy = getStrategy(userLevel);
    double bonus = strategy->calculate(dto.weight, price);
    // ... збереження транзакції ...
    return bonus;
}
```

4 ВИСНОВКИ

В ході виконання роботи було створено професійну серверну архітектуру системи EcoRecycle. Використання патернів Repository та Strategy забезпечує високу гнучкість системи та спрощує модульне тестування. Впровадження шару сервісів та DTO дозволило ізолювати бізнес-логіку від деталей реалізації HTTP та бази даних. Проєкт відповідає вимогам до сучасних Enterprise-рішень на C++.

5 ВИКОРИСТАНІ ДЖЕРЕЛА

1. Evans, E. Domain-Driven Design: Tackling Complexity in the Heart of Software.
2. Fowler, M. Patterns of Enterprise Application Architecture.
3. Crow C++ Framework & SQLite Documentation.
