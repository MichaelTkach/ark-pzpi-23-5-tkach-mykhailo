ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №4
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Розробка IoT клієнта»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Розробка прошивки для ESP32 та інтеграція з API |

2 ЗАВДАННЯ

1. Розробити програмне забезпечення для IoT-пристрою (Smart Recycling Station).
2. Реалізувати емуляцію апаратних сенсорів (ваги) та взаємодії з користувачем.
3. Забезпечити передачу даних на сервер через REST API.

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Архітектура IoT клієнта

Архітектура IoT клієнта для системи EcoRecycle спроектована з урахуванням автономності та енергоефективності. Система базується на мікроконтролері ESP32, який виконує роль контролера станції прийому сміття. Ключовими компонентами є емульований тензодатчик (ваги) для вимірювання маси зданої сировини та Wi-Fi модуль для комунікації з сервером.
Передача даних здійснюється через протокол HTTP (REST API), що забезпечує просту інтеграцію з існуючим веб-бекендом. Пристрій відправляє POST-запити на ендпоінт `/api/recycle` з JSON-корисним навантаженням.

3.2 Бізнес-логіка

Алгоритм роботи пристрою (Додаток Б.1) включає наступні кроки:
1. **Ініціалізація:** Пристрій встановлює з'єднання з Wi-Fi мережею.
2. **Очікування:** Система перебуває в режимі очікування події (натискання кнопки користувачем).
3. **Обробка:** При активації генерується випадкове значення ваги (5.0 - 10.0 кг), що імітує реальний процес зважування.
4. **Комунікація:** Сформований пакет даних відправляється на сервер.
5. **Зворотний зв'язок:** При успішній відповіді сервера (HTTP 200/201) активується світлодіодна індикація (блимання), що підтверджує користувачеві успішну транзакцію.

3.3 Налаштування та конфігурація

У коді реалізовано гнучку конфігурацію через глобальні константи, що дозволяє легко адаптувати прошивку під різні середовища розгортання:
- `WIFI_SSID` / `WIFI_PASSWORD` для налаштування мережі.
- `SERVER_URL` для вказівки адреси бекенду (використовується `host.wokwi.internal` для емуляції).
- Константи пінів (`BUTTON_PIN`, `LED_PIN`) для апаратної конфігурації.

4 ВИСНОВОК

У ході лабораторної роботи було розроблено та протестовано IoT-клієнт системи EcoRecycle. Використання платформи ESP32 та середовища симуляції Wokwi дозволило реалізувати повнофункціональний прототип станції прийому сміття. Реалізована бізнес-логіка забезпечує коректну фіксацію ваги та надійну передачу даних на сервер. Система готова до інтеграції в загальну інфраструктуру проєкту.

5 ВИКОРИСТАНІ ДЖЕРЕЛА

1. Espressif ESP32 Technical Reference Manual.
2. ArduinoJson Library Documentation.
3. PlatformIO Documentation.

ДОДАТОК А
Посилання на відео: https://youtu.be/Lj_oD8gnG9g 
00:00 Структура IoT клієнту 
00:31 Огляд коду прошивки
02:36 Тестування роботи в Wokwi

ДОДАТОК Б
Графічні матеріали

Рисунок Б.1 – Діаграма діяльності (Activity Diagram)

ДОДАТОК В
Фрагменти коду

В.1 Відправка даних на сервер
```cpp
void sendRecyclingDat() {
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(SERVER_URL);
    http.addHeader("Content-Type", "application/json");

    double weight = random(50, 1000) / 100.0; 
    int userId = 1; 
    int wasteId = 1; 

    String payload = "{";
    payload += "\"user_id\": " + String(userId) + ",";
    payload += "\"waste_id\": " + String(wasteId) + ",";
    payload += "\"weight\": " + String(weight);
    payload += "}";

    int httpResponseCode = http.POST(payload);

    if (httpResponseCode > 0) {
      if (httpResponseCode == 200 || httpResponseCode == 201) {
        blinkLED();
      }
    }
    http.end();
  }
}
```

В.2 Головний цикл
```cpp
void loop() {
  int currentState = digitalRead(BUTTON_PIN);

  if (lastButtonState == HIGH && currentState == LOW) {
    Serial.println("Button Pressed - Weighing...");
    delay(1000); 
    sendRecyclingDat();
  }
  lastButtonState = currentState;
  delay(50); 
}
```
