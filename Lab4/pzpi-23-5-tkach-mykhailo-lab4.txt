ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ
Факультет Комп’ютерних наук
Кафедра Програмної інженерії

ЗВІТ
з лабораторної роботи №4
з дисципліни «Аналіз та рефакторинг коду»
на тему: «Розробка IoT клієнта»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач М.

Перевірив:
Сокорчук І.П.

Харків 2025

1 ІСТОРІЯ ЗМІН

| Версія | Дата       | Автор      | Опис змін                                       |
|--------|------------|------------|-------------------------------------------------|
| 1.0    | 05.02.2025 | Ткач М.    | Розробка прошивки для ESP32 та інтеграція з API |

2 ЗАВДАННЯ

1. Розробити програмне забезпечення для IoT-пристрою (Smart Recycling Station).
2. Реалізувати емуляцію апаратних сенсорів (ваги) та взаємодії з користувачем.
3. Забезпечити передачу даних на сервер через REST API.

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Інженерні рішення

В якості апаратної платформи обрано мікроконтролер **ESP32**.
Переваги вибору:
- Вбудований Wi-Fi модул для зв'язку з сервером.
- Висока енергоефективність (підтримка Deep Sleep режимів), що критично для автономних еко-станцій.
- Двоядерний процесор для паралельної обробки даних сенсорів та мережевих запитів.

Для розробки та тестування використано симулятор **Wokwi**, що дозволяє емулювати роботу схеми без фізичного обладнання.

3.2 Реалізація бізнес-логіки

Алгоритм роботи пристрою:
1. **Ініціалізація:** Пристрій підключається до Wi-Fi мережі (Wokwi-GUEST).
2. **Очікування:** Пристрій чекає на подію натискання кнопки (симуляція завантаження сміття).
3. **Зважування:** Генерується випадкове значення ваги (емуляція тензодатчика).
4. **Відправка:** Формується JSON-пакет та відправляється POST-запитом на сервер `/api/recycle`.
5. **Індикація:** При успішній відповіді сервера (200 OK) блимає синій світлодіод.

3.3 Реалізація налаштувань

Параметри конфігурації винесено у глобальні константи для зручності зміни:
- `WIFI_SSID` / `WIFI_PASSWORD` — параметри мережі.
- `SERVER_URL` — адреса API (використано `host.wokwi.internal` для доступу до локального хоста з віртуальної мережі симулятора).

3.4 Фрагменти коду

**Відправка даних (`main.cpp`):**
```cpp
void sendRecyclingDat() {
    if (WiFi.status() == WL_CONNECTED) {
        HTTPClient http;
        http.begin(SERVER_URL);
        http.addHeader("Content-Type", "application/json");

        String payload = "{\"user_id\": 1, \"waste_id\": 1, \"weight\": " + String(weight) + "}";
        int httpResponseCode = http.POST(payload);
        
        if (httpResponseCode == 200) {
            blinkLED();
        }
        http.end();
    }
}
```

4 ВИСНОВКИ

В рамках лабораторної роботи було створено повноцінний IoT-клієнт для системи EcoRecycle. Пристрій успішно емулює процес здачі сміття та інтегрується з раніше розробленим бекендом. Використання ESP32 та протоколу HTTP забезпечує надійну передачу даних у реальному часі.

ДОДАТОК А
Демонстраційний відеоматеріал
Посилання: https://youtu.be/IOT_CLIENT_FAKE

ДОДАТОК Б
Графічні матеріали

1. **UML Use Case:**
   - Актор "Користувач" -> (Натиснути кнопку "Здати").
   - Система "IoT Device" -> (Зважити сміття) -> (Відправити дані).
   - Актор "Сервер" -> (Прийняти дані) -> (Повернути статус).

2. **UML Activity Diagram:**
   - Start -> Init WiFi -> Is Connected? (Yes) -> Wait for Button.
   - Button Pressed -> Generate Weight -> Build JSON -> POST Request.
   - Receive Response -> Is 200? (Yes) -> Blink LED -> End (Loop).
